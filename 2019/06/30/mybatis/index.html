<!DOCTYPE html>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>
    MyBatis框架 | TEAPER
  </title>
  <meta name="description" content="与人为善是修养，独来独往是性格！">
  
  <meta name="keywords" content="
  MyBatis
  ">
  
  <meta name="author" content="teaper">

  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="theme-color" content="#1e2327">
  <link rel="apple-touch-icon" href="https://github.githubassets.com/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://github.githubassets.com/apple-touch-icon-180x180.png">

  <link rel="icon" type="image/x-icon" href="https://i.loli.net/2019/06/04/5cf683cea837456459.jpeg">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/live2d/css/live2d.css">
  <link rel="stylesheet" href="/css/player.css">
  <link rel="stylesheet" href="/iconfont/iconfont.css">
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-140493383-1', 'auto');
  ga('send', 'pageview');
</script>


  

  <script src="//cdnjs.cloudflare.com/ajax/libs/vue/1.0.25-csp/vue.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
</head>

<body id="replica-app">

<nav class="navbar-wrapper">
  <div class="navbar">
    <div class="container clearfix">
      <a href="/" class="navbar-logo"><i class="fa fa-github"></i></a>

      <div class="navbar-search float-left desktop-only">
        <!-- <div class="navbar-search-form">
          <label for="gsc-i-id1">This website</label>
          <div id="google-search">
            <gcse:search></gcse:search>
          </div>
        </div> -->

		<div class="navbar-search-form">
		  <label for="gsc-i-id1">THIS WEBSITE</label>
          <div id="site_search">
        	<input type="text" id="local-search-input" style results="0">
          </div>
        </div>
		
      </div>

      <ul class="navbar-nav float-left">
        
        <li><a href="/archives">Archives</a></li>
        
        
        <li><a href="/categories">Categories</a></li>
        
        
        <li><a href="/tags">Tags</a></li>
        
        
        <li><a href="/links">Links</a></li>
        
		
        <li><a href="/files">Files</a></li>
        
        
        <li class="desktop-only"><a href="/atom.xml" target="_blank">RSS</a></li>
        
      </ul>

      <ul class="navbar-nav user-nav float-right desktop-only">
        <li class="user-nav-notification">
          <a><span class="user-nav-unread"></span><i class="fa fa-bell"></i></a>
        </li>
        <li>
          <a><i class="fa fa-plus"></i> <i class="fa fa-caret-down"></i></a>
        </li>
        <li class="user-nav-logo">
          <a><img src="https://i.loli.net/2019/06/04/5cf683cea837456459.jpeg"> <i class="fa fa-caret-down"></i></a>
        </li>
      </ul>
	  <!-- 站内搜索结果 -->
	  <br>
      <div id="local-search-result"></div>

    </div>
  </div>
</nav>

<div class="main-container">
  <header class="header-wrapper desktop-only">
  <div class="container header-site-detail">
    <ul class="header-toolbar">
      <li class="clearfix">
        <a href="/archives" class="header-toolbar-left"><i class="fa fa-file-text"></i> Posts </a>
        <a href="/archives" class="header-toolbar-right"> 22 </a>
      </li>
      <li>
        <a href="/tags" class="header-toolbar-left"><i class="fa fa-tags"></i> Tags </a>
        <a href="/tags" class="header-toolbar-right"> 54 </a>
      </li>
      <li>
        <a href="/categories" class="header-toolbar-left"><i class="fa fa-folder-open"></i> Categories </a>
        <a href="/categories" class="header-toolbar-right"> 12 </a>
      </li>
    </ul>
    <h2 class="header-title">
      <i class="fa fa-book text-muted"></i>
      <a href="/">TEAPER</a>
      
      
    </h2>
  </div>

  <div class="container">
    <div class="header-tab-wrapper clearfix">
      <span class="header-tab header-tab-selected"><i class="fa fa-thumbs-o-up"></i> Like</span>
      <span class="header-tab"><i class="fa fa-share-alt"></i> Share</span>
      <span class="header-tab"><i class="fa fa-comments-o"></i> Discussion</span>
      <span class="header-tab"><i class="fa fa-bookmark-o"></i> Bookmark </span>
      <span class="header-tab"><i class="fa fa-smile-o"></i> Smile <i class="fa fa-caret-down"></i></span>
    </div>
  </div>
</header>


<div class="post-container container">
  <h3>
    <i class="fa fa-user-o"></i>
    teaper

    <span class="post-date float-right" title="{{moment(1561873847000).format('MMM DD, YYYY, h:mm:ss A')}}">
      <i class="fa fa-pencil-square-o"></i>
      {{moment(1561873847000).fromNow()}}
    </span>
  </h3>

  <article class="post-content">
    <h1 style="text-align:center">MyBatis框架</h1>
    <h4 id="前身"><a class="header-anchor" href="#前身"></a>前身</h4>
<p>iBatis,Apache的一个开源框架;实体类和SQL语句之间建立映射关系</p>
<h4 id="特点"><a class="header-anchor" href="#特点"></a>特点</h4>
<p>基于SQL语法,简单易学<br>
开放源码,了解底层封装过程<br>
SQL语句封装在配置文件中,便于统一管理与维护,降低程序耦合度<br>
方便程序代码调试</p>
<h4 id="优点"><a class="header-anchor" href="#优点"></a>优点</h4>
<p>与JDBC相比,减少50%以上代码量<br>
最简单的持久化框架,小巧并简单易学<br>
SQL代码从程序中分离,可重用<br>
提供XML标签,支持编写动态SQL<br>
提供映射标签,支持对象与数据库的ORM字段关系映射</p>
<h4 id="缺点"><a class="header-anchor" href="#缺点"></a>缺点</h4>
<p>SQL语句编写量大,对开发人员有一定要求<br>
数据库移植性差</p>
<h4 id="使用Mybatis的开发步骤"><a class="header-anchor" href="#使用Mybatis的开发步骤"></a>使用Mybatis的开发步骤</h4>
<p><a href="https://github.com/mybatis/mybatis-3/releases" rel="external nofollow noopener noreferrer" target="_blank">下载</a>mybatis的jar包<br>
编写MyBatis核心配置文件(configuration.xml)<br>
创建实体类(pojo)<br>
DAO层-SQL映射文件(mapper.xml)<br>
创建测试类</p>
<ul>
<li>读取全局配置文件mybatis-config.xml</li>
<li>创建sqlSessionFactory对象,读取文件</li>
<li>创建SqlSession对象</li>
<li>调用mapper文件进行数据操作</li>
</ul>
<h4 id="MyBatis架包"><a class="header-anchor" href="#MyBatis架包"></a>MyBatis架包</h4>
<p>示例:mybatis-3.4.6</p>
<table>
<thead>
<tr>
<th>架包</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://mvnrepository.com/artifact/org.ow2.asm/asm" rel="external nofollow noopener noreferrer" target="_blank">asm-5.2.jar</a></td>
<td>操作Java字节码的类库</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/cglib/cglib" rel="external nofollow noopener noreferrer" target="_blank">cglib-3.2.5.jar</a></td>
<td>动态集成java类或实现接口</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/commons-logging/commons-logging" rel="external nofollow noopener noreferrer" target="_blank">commons-logging-1.2.jar</a></td>
<td>用于通用日志处理</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/org.javassist/javassist" rel="external nofollow noopener noreferrer" target="_blank">javassist-3.22.0-GA.jar</a></td>
<td>分析,编辑和创建Java字节码的类库</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/log4j/log4j" rel="external nofollow noopener noreferrer" target="_blank">log4j-1.2.17.jar</a></td>
<td>日志系统</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api" rel="external nofollow noopener noreferrer" target="_blank">log4j-api-2.3.jar</a></td>
<td>日志系统的封装,对外提供统一的API接口</td>
</tr>
<tr>
<td><a href="https://mvnrepository.com/artifact/org.slf4j/slf4j-log4j12" rel="external nofollow noopener noreferrer" target="_blank">slf4j-log4j12-1.7.25.jar</a></td>
<td>slf4对log4的相应驱动,完成slf4绑定log4</td>
</tr>
</tbody>
</table>
<h4 id="导入jar包"><a class="header-anchor" href="#导入jar包"></a>导入jar包</h4>
<p>选取jar包导入工程:普通java项目Build Path,web项目放lib文件夹,maven项目配置pom.xml</p>
<blockquote>
<p><a href="https://mvnrepository.com/artifact/org.mybatis/mybatis" rel="external nofollow noopener noreferrer" target="_blank">mybatis-3.4.6.jar</a><br>
<a href="https://mvnrepository.com/artifact/org.apache.logging.log4j/log4j-api" rel="external nofollow noopener noreferrer" target="_blank">log4j-api-2.3.jar</a><br>
<a href="https://mvnrepository.com/artifact/mysql/mysql-connector-java" rel="external nofollow noopener noreferrer" target="_blank">mysql-connector-java-8.0.11.jar</a></p>
</blockquote>
<h4 id="MyEclipse中mybatis-3-4-6绑定源代码"><a class="header-anchor" href="#MyEclipse中mybatis-3-4-6绑定源代码"></a>MyEclipse中mybatis-3.4.6绑定源代码</h4>
<p>右击项目工程中的mybatis-3.4.6.jar -&gt; Properties -&gt; Java Source Attachment -&gt; External File;找到下载的mybatis-3.4.6.zip文件<span style="color:#ff0000;">(maven项目会自动从仓库中绑定源码)<span></span></span></p>
<h4 id="添加DTD模板"><a class="header-anchor" href="#添加DTD模板"></a>添加DTD模板</h4>
<p>两个文件<code>mybatis-3-config.dtd</code> 和 <code>mybatis-3-mapper.dtd</code> 在 <code>mybatis-3.4.6/mybatis-3.4.6/org/apache/ibatis/builder/xml</code> 文件夹中,将它们拷贝到mybatis-3.4.6目录中;Windows -&gt; Properties,输入xml,选择XML Catalog -&gt; Add,单击File System按钮,选择dtd文件,Key的值,去 <code>mybatis-3.4.6/mybatis-3.4.6.pdf</code> 官方文档最后一章中找,当前版本: <code>-//mybatis.org//DTD Config 3.0//EN</code> 和 <code>-//mybatis.org//DTD Mapper 3.0//EN</code> ,对应config.dtd和mapper.dtd</p>
<h4 id="编写mybatis-config-xml"><a class="header-anchor" href="#编写mybatis-config-xml"></a>编写mybatis-config.xml</h4>
<p>选择 resources 文件夹,右击新建 xml,选择 <code>XML(Basic Templates)</code>,输入文件名,选择 <code>Create XML file from a DTD file</code> 单选按钮,下一步,选择 <code>Select XML Catalog entry</code>,在列表中找到 <code>-//mybatis.org//DTD Config 3.0//EN</code> ;下一步,勾选最后两项复选框(默认是勾选的),完成!<br>
配置XML的节点是有顺序的,实在不知道其中顺序,可以在 <code>mybatis-config.xml</code> 文件下选择Design视图,右击configuration节点 -&gt; Add Child,指定一个节点插入进去,可以保证节点位置匹配正确</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN" "mybatis-3-config.dtd" &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入database.properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"database.properties"</span>/&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 配置mybatis的log实现Log4j --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"LOG4J"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 设置别名,mapper.xml中可以直接返回类型名称  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Bill"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Bill"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Provider"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Provider"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Role"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Role"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"User"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.User"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 配置多套运行环境,environments default指定使用哪一套 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 第一套运行环境(开发) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置JDBC事务管理 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置数据源:POOLED(MyBatis自带) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 参数匹配database.properties文件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">        <span class="comment">&lt;!-- 第二套运行环境(部署) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"deploy"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置JDBC事务管理 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置数据源:POOLED(MyBatis自带) --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- 参数匹配database.properties文件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">value</span>=<span class="string">"$&#123;user&#125;"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">     </span><br><span class="line">    <span class="comment">&lt;!-- 将mapper文件加入到映射中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/smbms/dao/bill/BillMapper.xml"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/smbms/dao/provider/ProviderMapper.xml"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/smbms/dao/role/RoleMapper.xml"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/smbms/dao/user/UserMapper.xml"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line">     </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>mybatis-config核心配置文件目录结构:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">|configuration <span class="comment">#配置</span></span><br><span class="line">|---properties <span class="comment">#可配置在Java属性文件中</span></span><br><span class="line">|---settings <span class="comment">#修改MyBatis在运行时的行为方式</span></span><br><span class="line">|---typeAliases <span class="comment">#为Java类型命名一个别名(简称),用于Mapper.xml文件的返回类型</span></span><br><span class="line">|---typeHandlers <span class="comment">#类型处理器</span></span><br><span class="line">|---objectFactory <span class="comment">#对象工厂</span></span><br><span class="line">|---plugins <span class="comment">#插件</span></span><br><span class="line">|---environment <span class="comment">#环境</span></span><br><span class="line">|   |---transactionManager <span class="comment">#事务管理器</span></span><br><span class="line">|   |---dataSource <span class="comment">#数据源</span></span><br><span class="line">|---mappers <span class="comment">#映射器</span></span><br></pre></td></tr></table></figure>
<h4 id="创建POJO实体类"><a class="header-anchor" href="#创建POJO实体类"></a>创建POJO实体类</h4>
<details>
<summary>User类</summary>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.smbms.pojo;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;             <span class="comment">//id</span></span><br><span class="line">    <span class="keyword">private</span> String userCode;        <span class="comment">//用户编码</span></span><br><span class="line">    <span class="keyword">private</span> String userName;        <span class="comment">//用户名称</span></span><br><span class="line">    <span class="keyword">private</span> String userPassword;    <span class="comment">//用户密码</span></span><br><span class="line">    <span class="keyword">private</span> Integer gender;         <span class="comment">//性别</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;          <span class="comment">//出生日期</span></span><br><span class="line">    <span class="keyword">private</span> String phone;           <span class="comment">//电话</span></span><br><span class="line">    <span class="keyword">private</span> String address;         <span class="comment">//地址</span></span><br><span class="line">    <span class="keyword">private</span> Integer userRole;       <span class="comment">//用户角色</span></span><br><span class="line">    <span class="keyword">private</span> Integer createdBy;      <span class="comment">//创建者</span></span><br><span class="line">    <span class="keyword">private</span> Date creationDate;      <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Integer modifyBy;       <span class="comment">//更新者</span></span><br><span class="line">    <span class="keyword">private</span> Date modifyDate;        <span class="comment">//更新时间</span></span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span>  String idPicPath;</span><br><span class="line">    <span class="keyword">private</span> String workPicPath;</span><br><span class="line">    <span class="keyword">private</span> Integer age;<span class="comment">//年龄</span></span><br><span class="line">    <span class="keyword">private</span> String userRoleName;    <span class="comment">//用户角色名称</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userCode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserCode</span><span class="params">(String userCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userCode = userCode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userPassword;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserPassword</span><span class="params">(String userPassword)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userPassword = userPassword;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(Integer gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getBirthday</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> birthday;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBirthday</span><span class="params">(Date birthday)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPhone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(String address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUserRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRole;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserRole</span><span class="params">(Integer userRole)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userRole = userRole;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCreatedBy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createdBy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreatedBy</span><span class="params">(Integer createdBy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createdBy = createdBy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreationDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> creationDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreationDate</span><span class="params">(Date creationDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.creationDate = creationDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getModifyBy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> modifyBy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setModifyBy</span><span class="params">(Integer modifyBy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.modifyBy = modifyBy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getModifyDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> modifyDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setModifyDate</span><span class="params">(Date modifyDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.modifyDate = modifyDate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getIdPicPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> idPicPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setIdPicPath</span><span class="params">(String idPicPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.idPicPath = idPicPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getWorkPicPath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> workPicPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWorkPicPath</span><span class="params">(String workPicPath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.workPicPath = workPicPath;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userRoleName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserRoleName</span><span class="params">(String userRoleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userRoleName = userRoleName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String userCode, String userName, String userPassword, Integer gender, Date birthday,</span></span></span><br><span class="line"><span class="function"><span class="params">            String phone, String address, Integer userRole, Integer createdBy, Date creationDate, Integer modifyBy,</span></span></span><br><span class="line"><span class="function"><span class="params">            Date modifyDate, String idPicPath, String workPicPath, Integer age, String userRoleName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.userCode = userCode;</span><br><span class="line">        <span class="keyword">this</span>.userName = userName;</span><br><span class="line">        <span class="keyword">this</span>.userPassword = userPassword;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">        <span class="keyword">this</span>.phone = phone;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">        <span class="keyword">this</span>.userRole = userRole;</span><br><span class="line">        <span class="keyword">this</span>.createdBy = createdBy;</span><br><span class="line">        <span class="keyword">this</span>.creationDate = creationDate;</span><br><span class="line">        <span class="keyword">this</span>.modifyBy = modifyBy;</span><br><span class="line">        <span class="keyword">this</span>.modifyDate = modifyDate;</span><br><span class="line">        <span class="keyword">this</span>.idPicPath = idPicPath;</span><br><span class="line">        <span class="keyword">this</span>.workPicPath = workPicPath;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.userRoleName = userRoleName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</details>
<blockquote>
<p>Get,Set方法及构造方法,使用快捷键<span style="color:#ff0000;">Shift+Alt+S</span><br>
Get,Set:选择Generate Getters and Setters…命令,勾选Select All复选框,选择public单选按钮,完成<br>
构造方法:选择Generate Constructor using Fields…命令,勾选Select All复选框,选择public单选按钮,完成;再重复一次,勾选Deselect All复选框,完成!那么带参和不带参的构造方法都有了</p>
</blockquote>
<h4 id="DAO层编写Interface接口"><a class="header-anchor" href="#DAO层编写Interface接口"></a>DAO层编写Interface接口</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------UserMapper.java-------------------------------</span><br><span class="line"><span class="keyword">package</span> cn.smbms.dao.user;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> cn.smbms.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//无条件查询记录数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="DAO层编写Mapper-xml映射"><a class="header-anchor" href="#DAO层编写Mapper-xml映射"></a>DAO层编写Mapper.xml映射</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------UserMapper.xml------------------------------------</span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.smbms.dao.user.UserMapper"</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleName"</span> <span class="attr">property</span>=<span class="string">"roleName"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userPassword"</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"phone"</span> <span class="attr">property</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRole"</span> <span class="attr">property</span>=<span class="string">"userRole"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createdBy"</span> <span class="attr">property</span>=<span class="string">"createdBy"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"creationDate"</span> <span class="attr">property</span>=<span class="string">"creationDate"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"modifyBy"</span> <span class="attr">property</span>=<span class="string">"modifyBy"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"modifyDate"</span> <span class="attr">property</span>=<span class="string">"modifyDate"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"idPicPath"</span> <span class="attr">property</span>=<span class="string">"idPicPath"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"workPicPath"</span> <span class="attr">property</span>=<span class="string">"workPicPath"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRoleName"</span> <span class="attr">property</span>=<span class="string">"userRoleName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"Count"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">        select count(*) as count from smbms_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">--------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>编写好之后,记得在mybats-config.xml中配置映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------mybatis-config.xml----------------------------------------</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span> <span class="string">"mybatis-3-config.dtd"</span> &gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- 已省略其他配置信息 --&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 将mapper文件加入到映射中 --&gt;</span><br><span class="line">    &lt;mappers&gt;</span><br><span class="line">        &lt;mapper resource=<span class="string">"cn/smbms/dao/user/UserMapper.xml"</span>/&gt;</span><br><span class="line">    &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br><span class="line">---------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="编写测试代码"><a class="header-anchor" href="#编写测试代码"></a>编写测试代码</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------app.java----------------------------------------</span><br><span class="line"><span class="keyword">package</span> cn.smbms;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//使用MyBatis(基础)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger  logger =Logger.getLogger(App.class);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//使用@Test必须引入junit架包</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String resource=<span class="string">"mybatis-config.xml"</span>;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 获取mybatis-config.xml的输入流</span></span><br><span class="line">            InputStream is = Resources.getResourceAsStream(resource);</span><br><span class="line">            <span class="comment">//2 创建SqlSessionFactory对象,完成对配置文件的读取</span></span><br><span class="line">            SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">            <span class="comment">//3 创建sqlSession</span></span><br><span class="line">            sqlSession = factory.openSession();</span><br><span class="line">            <span class="comment">//4 调用mapper文件的namespace和子元素的id来找到相应SQL并且执行,必须将mapper文件引入到mybatis-config.xml中</span></span><br><span class="line">            count = sqlSession.selectOne(<span class="string">"smbms.dao.user.UserMapper.Count"</span>);</span><br><span class="line">            logger.debug(<span class="string">"COUNT等于:----&gt;"</span>+count);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//关闭sqlSession对象</span></span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>MyBatis的核心接口和类:<br>
<span style="color:#ff9900;">SqlSessionFactoryBuilder</span></p>
<blockquote>
<p>用过即丢,其生命周期只存在于方法体内<br>
可重用其来创建多个SqlSessionFactory实例<br>
负责构建SqlSessionFactory,并提供多个build方法的重载</p>
</blockquote>
<p><span style="color:#ff9900;">SqlSessionFactory</span></p>
<blockquote>
<p>SqlSessionFactory是每个MyBatis应用的核心<br>
作用:创建SqlSession实例<br>
作用域:Application<br>
生命周期与应用周期相同<br>
单例模式:存在与整个应用运行时,并且同时只存在一个对象实例</p>
</blockquote>
<p><span style="color:#ff9900;">SqlSession</span></p>
<blockquote>
<p>包含了执行SQL所需要的所有方法<br>
对应一次数据库会话,会话结束必须关闭<br>
线程级别,不能共享</p>
</blockquote>
<p>mybatis-config.xml 系统核心配置文件<br>
mapper.xml SQl映射文件</p>
<h4 id="优化测试代码"><a class="header-anchor" href="#优化测试代码"></a>优化测试代码</h4>
<p>上面代码中,我们通过获取 <code>mybatis-config.xml</code> 的输入流;创建 <code>SqlSessionFactory</code> 对象,通过 <code>SqlSessionFactoryBuilder().build()</code> 方法创建factory工厂;使用工厂创建创建sqlSession;调用sqlSession的相应方法,还要输入namespace.id路径!<br>
步骤繁琐,代码冗余!我们可以通过创建工具类MyBatisUtil从而简化代码,使其高效可用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------MyBatisUtil.java--------------------------------</span><br><span class="line"><span class="keyword">package</span> cn.smbms.tools;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory;</span><br><span class="line">    <span class="keyword">static</span>&#123;<span class="comment">//静态代码块,factory只创建一次</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">            factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title">creataSqlSession</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> factory.openSession(<span class="keyword">false</span>);<span class="comment">//true为自动提交事务</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">closeSqlSession</span><span class="params">(SqlSession sqlSession)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">null</span> != sqlSession)</span><br><span class="line">            sqlSession.close();<span class="comment">//关闭SqlSession</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>MyBatisUtil中提供了两个静态方法 <code>creataSqlSession()</code> 和 <code>closeSqlSession()</code>;那么我们app.java的代码中就不需要获取mybatis-config.xml的输入流及创建SqlSessionFactory对象了,而是可以直接通过MyBatisUtil.creataSqlSession()方法直接得到sqlSession对象,但是我们还是需要使用指定 <code>namespace.id</code> 路径进行数据查找,如果我们需要使用sqlSession.getMapper()方式,我们需要创建一个接口类,定义一个接口方法去指定Mapper.xml中的id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.java------------------------------------</span><br><span class="line"><span class="keyword">package</span> cn.smbms.dao.user;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"><span class="keyword">import</span> cn.smbms.pojo.User;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">//查询记录数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">注意:方法名(示例:getCount)必须与UserMapper.xml中的id值一一对应</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------UserMapper.xml------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCount"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    select count(*) as count from smbms_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">--------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>那么就需要把UserMapper.xml这里原来的id=&quot;Count&quot;改为id=“getCount”</p>
<p>这样,我们就可以使用MyBatisUtil创建和关闭SqlSession,使用getMapper()方式指定Mapper文件id进行数据查找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------app.java----------------------------------------</span><br><span class="line"><span class="keyword">package</span> cn.smbms;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//使用MyBatis(进阶)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Logger  logger =Logger.getLogger(App.class);</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 创建sqlSession</span></span><br><span class="line">            sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">            <span class="comment">//2 使用getMapper方式,需要先创建interface方法,且interface方法名和mapper.xml中id保持一致</span></span><br><span class="line">            count = sqlSession.getMapper(UserMapper.class).getCount();</span><br><span class="line">            logger.debug(<span class="string">"COUNT等于:----&gt;"</span>+count);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//3 关闭sqlSession对象</span></span><br><span class="line">            MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="目录结构"><a class="header-anchor" href="#目录结构"></a>目录结构</h4>
<p>mybatis-config.xml目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|configuration</span><br><span class="line">|---properties</span><br><span class="line">|   |---property</span><br><span class="line">|---settings</span><br><span class="line">|   |---setting</span><br><span class="line">|---typeAliases</span><br><span class="line">|---typeHandlers</span><br><span class="line">|---objectFactory</span><br><span class="line">|---plugins</span><br><span class="line">|---environment</span><br><span class="line">|   |---transactionManager</span><br><span class="line">|   |---dataSource</span><br><span class="line">|---mappers</span><br></pre></td></tr></table></figure>
<h4 id="properties元素"><a class="header-anchor" href="#properties元素"></a>properties元素</h4>
<p>作用:描述外部可替代属性,获取属性有两种方法</p>
<p>方法一:通过外部指定方式(database.properties)实现配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入database.properties文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"database.properties"</span>/&gt;</span></span><br><span class="line"> </span><br><span class="line">......省略其他配置</span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- 配置数据源:POOLED(MyBatis自带) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 参数匹配database.properties文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方法二:直接配置为XML,实现动态配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"com.mysql.cj.jdbc.Driver"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://127.0.0.1:3306/smbms?useUnicode=true&amp;characterEncoding=utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">优先级:方法一 &gt; 方法二</span><br>
原因:resource中的属性值会覆盖property元素的值</p>
<h4 id="settings元素"><a class="header-anchor" href="#settings元素"></a>settings元素</h4>
<p>作用:设置一些非常重要的设置选项,用于设置和改变MyBatis运行中的行为</p>
<table>
<thead>
<tr>
<th>设置项</th>
<th>描述</th>
<th>允许值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>cacheEnabled</td>
<td>对在此配置下的所有cache进行全局性开/关设置</td>
<td>ture/false</td>
<td>ture</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>全局性设置延迟加载,如果设置为false,则所有相关联的都会被初始化加载</td>
<td>ture/false</td>
<td>ture</td>
</tr>
<tr>
<td>autoMappingBehavior</td>
<td>MyBatis对于resultMap自动映射的匹配级别</td>
<td>NONE/PARTIAL/FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>…其他省略(共9个)</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>配置方式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logImpl"</span> <span class="attr">value</span>=<span class="string">"LOG4J"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="typeAliases元素"><a class="header-anchor" href="#typeAliases元素"></a>typeAliases元素</h4>
<p>作用:仅仅关联XML配置,简写冗长的Java类名,方便Mapper.xml使用<br>
配置方式:<br>
方法一:单独指定,适用于少量javabean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Bill"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Bill"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Provider"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Provider"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Role"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Role"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"User"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.User"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方法二:指定包名,适用大量javabean,别名就是类名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.smbms.pojo"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">如果没有配置,那么在Mapper.xml中,resultType返回类型就需要写长路径</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------------UserMapper.xml(未配置)-----------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCount"</span> <span class="attr">resultType</span>=<span class="string">"cn.smbms.pojo.User"</span>&gt;</span></span><br><span class="line">    select * from smbms_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>配置后直接填别名或类名即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------------UserMapper.xml(已配置)-----------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCount"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select * from smbms_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="environment元素"><a class="header-anchor" href="#environment元素"></a>environment元素</h4>
<p>作用:用于配置多套运行环境,将SQl映射到不同数据库;一个environment子元素为一套运行环境,多套运行环境需要在default属性中指定子元素id名称,表示默认使用此运行环境</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第一套运行环境(开发) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置JDBC事务管理(JDBC/MANAGED) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driver&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">&lt;!-- 第二套运行环境(测试) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"test"</span>&gt;</span></span><br><span class="line">    ......省略</span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>子元素transactionManager(事务管理):</p>
<ul>
<li>JDBC:使用JDBC提交和回滚功能,依赖于从数据源获得连接来管理事务的生命周期</li>
<li>MANAGED:几乎不执行任何操作,它永远不会提交或回滚连接;相反,它允许容器管理事务的整个生命周期</li>
</ul>
<p>子元素dataSource(数据源):</p>
<ul>
<li>作用:使用基本的JDBC数据源接口类配置JDBC连接对象的资源</li>
<li>类型:
<ul>
<li>UNPOOLED:只在每次请求时打开和关闭连接,有点慢,适用于不需要立即连接性能的简单应用程序</li>
<li>POOLED:将JDBC Connection对象池化,以避免创建新Connection实例所需的初始连接和身份验证时间,这是并发Web应用程序实现最快响应的流行方法</li>
<li>JNDI:此实现旨在与EJB或Application Server等容器一起使用,这些容器可以集中或外部配置DataSource,并在JNDI上下文中对其进行引用</li>
</ul>
</li>
</ul>
<h4 id="mappers元素"><a class="header-anchor" href="#mappers元素"></a>mappers元素</h4>
<p>作用:定义SQL映射语句<br>
配置方式:<br>
方式一:使用类资源路径</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/smbms/dao/user/UserMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式二:使用完全限定资源定位符（URL）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">url</span>=<span class="string">"file:///var/mappers/AuthorMapper.xml"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式三:使用映射器接口实现类的完全限定类名</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">"org.mybatis.builder.AuthorMapper"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>方式四:将包内的映射器接口实现全部注册为映射器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"org.mybatis.builder"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="深入映射文件Mapper-xml"><a class="header-anchor" href="#深入映射文件Mapper-xml"></a>深入映射文件Mapper.xml</h4>
<p>特点:专注于SQl,功能强大,映射配置却相当简单<br>
顶级元素:</p>
<ul>
<li><span style="color:#ff9900;">cache</span> 为给定命名空间配置缓存</li>
<li><span style="color:#ff9900;">cache-ref</span> 从另一个命名空间引用缓存配置</li>
<li><span style="color:#ff9900;">resultMap</span> 描述如何从数据库结果集加载对象的最复杂和最强大的元素</li>
<li><span style="color:#ff9900;">sql</span> 可重用的SQL块，可以被其他语句引用</li>
<li><span style="color:#ff9900;">insert</span> 映射的INSERT语句</li>
<li><span style="color:#ff9900;">update</span> 映射的UPDATE语句</li>
<li><span style="color:#ff9900;">delete</span> 映射的DELETE语句</li>
<li><span style="color:#ff9900;">select</span> 映射的SELECT语句</li>
</ul>
<h4 id="seslect元素"><a class="header-anchor" href="#seslect元素"></a>seslect元素</h4>
<p>属性:</p>
<ul>
<li>id:命名空间唯一标识符,接口方法与Mapper文件的SQL语句id一一对应</li>
<li>parameterType:传入SQL语句的参数类型的完美限定名或别名
<ul>
<li>基础数据类型:
<ul>
<li>int,String,Date</li>
<li>只能传入一个,通过 <code>#{参数名}</code> 即可获取传入的值</li>
</ul>
</li>
<li>复杂数据类型:
<ul>
<li>Java实体类,Map等</li>
<li>通过 <code>#{属性名}</code> 或者 <code>#{Map的Key}</code> 即可获取传入的值</li>
</ul>
</li>
</ul>
</li>
<li>resultType:SQl语句返回值类型(类名/别名)</li>
</ul>
<h4 id="单条件查询"><a class="header-anchor" href="#单条件查询"></a>单条件查询</h4>
<blockquote>
<p>示例:根据用户id查询用户信息</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">------------------------------Mapper.xml-------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByUserName"</span> <span class="attr">parameterType</span>=<span class="string">"String"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>说明:Mapper.xml中SQl语句拼接String参数,需要使用concat()方式,传参格式为#{},并且参数名称(示例:userName)需要和接口类的方法参数或@Param()值相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------UserMapper.java---------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByUserName</span><span class="params">(@Param(<span class="string">"userName"</span>)</span> String userName) <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>说明:@Param()配置参数别名,用于多参数入参,Mapper.xml中可以直接使用#{参数别名}</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------TeatUserMapper.java----------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByUserName</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByUserName(<span class="string">"明"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User user:userlist)&#123;</span><br><span class="line">        logger.debug(user.getAddress()+<span class="string">"\t"</span>+user.getUserName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">--------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="多条件查询"><a class="header-anchor" href="#多条件查询"></a>多条件查询</h4>
<p><span style="color:#ff0000;">方法一:封装成Map对象进行入参</span></p>
<blockquote>
<p>示例:根据Map查询用户信息</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------Mapper.xml-------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByMap"</span> <span class="attr">resultType</span>=<span class="string">"User"</span> <span class="attr">parameterType</span>=<span class="string">"Map"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where userName like concat ('%',#&#123;userName&#125;,'%') and userRole=#&#123;userRole&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------UserMapper.java-----------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByMap</span><span class="params">(Map&lt;String,String&gt; userMap)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------TeatUserMapper.java---------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByMap</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Map&lt;String,String&gt; userMap=<span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">    userMap.put(<span class="string">"userName"</span>, <span class="string">"明"</span>);</span><br><span class="line">    userMap.put(<span class="string">"userRole"</span>, <span class="string">"2"</span>);</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByMap(userMap);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getAddress()+<span class="string">"\t"</span>+_user.getUserName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法二:封装成User对象进行入参</span></p>
<blockquote>
<p>示例:根据封装的用户名称及用户类型查询用户信息</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------Mapper.xml---------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByUser"</span> <span class="attr">resultType</span>=<span class="string">"User"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where userName like concat ('%',#&#123;userName&#125;,'%') and userRole=#&#123;userRole&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.java--------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUserName(<span class="string">"明"</span>);</span><br><span class="line">    user.setUserRole(<span class="number">2</span>);</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByUser(user);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getAddress()+<span class="string">"\t"</span>+_user.getUserName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="使用resultMap连表查询"><a class="header-anchor" href="#使用resultMap连表查询"></a>使用resultMap连表查询</h4>
<blockquote>
<p>示例:按条件查询用户列表,而用户表有外键userRole字段</p>
</blockquote>
<p><span style="color:#ff0000;">方法一:修改User.java实体类,增加userRoleName属性</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---------------------User.java---------------------</span><br><span class="line"><span class="keyword">private</span> String userRoleName;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getUserRoleName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> userRoleName;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserRoleName</span><span class="params">(String userRoleName)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.userRoleName = userRoleName;</span><br><span class="line">&#125;</span><br><span class="line">---------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-------------------------UserMapper.java-------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml-------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultType</span>=<span class="string">"User"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r</span><br><span class="line">     where userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">      and userRole=#&#123;userRole&#125; and u.userRole=r.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUserName(<span class="string">"明"</span>);</span><br><span class="line">    user.setUserRole(<span class="number">2</span>);</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserList(user);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getAddress()+<span class="string">"\t"</span>+_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRoleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法二:使用resultMap自定义映射结果(推荐)</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------UserMapper.xml-----------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleName"</span> <span class="attr">property</span>=<span class="string">"roleName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRole"</span> <span class="attr">property</span>=<span class="string">"userRole"</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRoleName"</span> <span class="attr">property</span>=<span class="string">"userRoleName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r</span><br><span class="line">     where userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">      and userRole=#&#123;userRole&#125; and u.userRole=r.id</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>select属性的返回就不是resultType,而是resultMap,值对应resultMap的id属性<br>
其他地方不变,执行方法一中的测试方法testGetUserList()即可</p>
<p>resultMap节点属性说明:</p>
<ul>
<li><span style="color:#ff9900;">resultMap</span>:描述如何将结果集映射到Java对象(属性名和字段名不一致的情况下使用)</li>
<li><span style="color:#ff9900;">type</span>:pojo类名</li>
<li><span style="color:#ff9900;">id</span>:resultMap别名</li>
<li><span style="color:#ff9900;">column</span>:数据库字段名</li>
<li><span style="color:#ff9900;">property</span>:pojo实体类属性名</li>
</ul>
<p><span style="color:#ff0000;">比较resultType和resultMap</span><br>
<span style="color:#ff9900;">resultType</span>:直接表示返回类型</p>
<ul>
<li>基础数据类型</li>
<li>复杂数据类型</li>
</ul>
<p><span style="color:#ff9900;">resultMap</span>:对外部resultMap的引用</p>
<ul>
<li>应用场景
<ul>
<li>数据库字段信息与对象属性不一致</li>
<li>复杂的联合查询,自由控制映射结果(自由创建和删除result)</li>
</ul>
</li>
</ul>
<p><span style="color:#ff0000;">注意:二者不能同时存在,本质上都是Map数据结构</span></p>
<blockquote>
<p>示例:使用resultMap如何实现自由灵活的控制映射结果,从而达到只对关心的属性进行赋值?</p>
</blockquote>
<p>目前,我们在&quot;方法二:使用resultMap自定义映射结果&quot;中,UserMapper.xml中只有id roleName address userRole userRoleName五个属性</p>
<p>在User.java新增年龄字段age,注意:数据库中没有age字段</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-----------------------User.java-------------------------</span><br><span class="line"><span class="keyword">private</span> Integer age;<span class="comment">//新增年龄</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Date date = <span class="keyword">new</span> Date();</span><br><span class="line">    Integer age = date.getYear()-birthday.getYear();</span><br><span class="line">    <span class="keyword">return</span> age;</span><br><span class="line">&#125;</span><br><span class="line">---------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>再修改测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUserName(<span class="string">"明"</span>);</span><br><span class="line">    user.setUserRole(<span class="number">2</span>);</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserList(user);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        <span class="comment">//新增输出age的值</span></span><br><span class="line">        logger.debug(_user.getAddress()+<span class="string">"\t"</span>+_user.getUserName()+<span class="string">"\t"</span></span><br><span class="line">        +_user.getUserRoleName()+<span class="string">"\t"</span>+_user.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------运行结果-------------------------------------------------</span><br><span class="line">2018-09-18 15:14:41,361 [main] DEBUG [cn.smbms.test.user.TeatUserMapper] - 北京市东城区前门东大街9号    李明  经理  35</span><br><span class="line">--------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>明明没有在resultMap中配置age,为什么还是会输出呢?这里就要说下resultMap自动映射级别了</p>
<p>resultMap自动匹配前提:字段名与属性名一致</p>
<p>resultMap的自动映射级别<span style="color:#ff9900;">(autoMappingBehavior)</span></p>
<blockquote>
<p><span style="color:#ff9900;">PARTIAL(默认)</span>:自动匹配所有属性,有内部嵌套(association,collection)的除外<br>
<span style="color:#ff9900;">NONE</span>:禁止自动匹配<br>
<span style="color:#ff9900;">FULL</span>:自动匹配所有</p>
</blockquote>
<p>所以,age我们虽然没匹配,不过在getAge()方法中,birthday属性是数据中有的,通过默认自动映射进去了,从而计算出age的值,如果我们不想让他默认自动映射,就需要去mybatis-config.xml中配置自动映射级别</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--------------------mybatis-config.xml-----------------</span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingBehavior"</span> <span class="attr">value</span>=<span class="string">"NONE"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">-------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="使用MyBatis增删改查"><a class="header-anchor" href="#使用MyBatis增删改查"></a>使用MyBatis增删改查</h4>
<h5 id="insert语句"><a class="header-anchor" href="#insert语句"></a>insert语句</h5>
<blockquote>
<p>示例:新增用户信息</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------UserMapper.java---------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">--------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------------UserMapper.xml-------------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"add"</span>  <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    INSERT INTO smbms_user                                                             </span><br><span class="line">    (userCode,userName,userPassword,gender,birthday,phone,address,userRole,createdBy,`creationDate`)</span><br><span class="line">    VALUES(#&#123;userCode&#125;,#&#123;userName&#125;,#&#123;userPassword&#125;,#&#123;gender&#125;,#&#123;birthday&#125;,#&#123;phone&#125;,#&#123;address&#125;,#&#123;userRole&#125;,#&#123;createdBy&#125;,#&#123;creationDate&#125;)</span><br><span class="line"> <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUserCode(<span class="string">"teaper"</span>);</span><br><span class="line">        user.setUserName(<span class="string">"茶巴"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"1234567"</span>);</span><br><span class="line">        Date birthday=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"2017-5-6"</span>);</span><br><span class="line">        user.setBirthday(birthday);</span><br><span class="line">        user.setAddress(<span class="string">"测试新增用户"</span>);</span><br><span class="line">        user.setGender(<span class="number">1</span>);</span><br><span class="line">        user.setPhone(<span class="string">"14588345567"</span>);</span><br><span class="line">        user.setUserRole(<span class="number">1</span>);</span><br><span class="line">        user.setCreatedBy(<span class="number">1</span>);</span><br><span class="line">        user.setCreationDate(<span class="keyword">new</span> Date());</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).add(user);</span><br><span class="line">        <span class="comment">//模拟异常,进行回滚</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.debug(<span class="string">"是否添加成功------&gt;"</span>+count);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>上面我们使用了回滚,因为我们在MyBatisUtil.java中开启了事务控制<br>
factory.openSession(false); //true为自动提交事务</p>
<p>注意:增删改(insert,delete,update)操作数据库时,需要注意两点</p>
<blockquote>
<p>增删改操作返回执行SQL影响的行数(int)<br>
insert,delete,update元素中没有resultType属性,只有select才有resultType/resultMap属性</p>
</blockquote>
<h5 id="update语句"><a class="header-anchor" href="#update语句"></a>update语句</h5>
<blockquote>
<p>示例:根据用户ID修改用户信息</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------UserMapper.java---------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">modify</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">--------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------UserMapper.xml-------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"modify"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    UPDATE smbms_user set userCode=#&#123;userCode&#125;,userName=#&#123;userName&#125;,userPassword=#&#123;userPassword&#125;,gender=#&#123;gender&#125;,</span><br><span class="line">    birthday=#&#123;birthday&#125;,phone=#&#123;phone&#125;,address=#&#123;address&#125;,userRole=#&#123;userRole&#125;,modifyBy=#&#123;modifyBy&#125;,</span><br><span class="line">    modifyDate=#&#123;modifyDate&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModify</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">16</span>);</span><br><span class="line">        user.setUserCode(<span class="string">"teaper"</span>);</span><br><span class="line">        user.setUserName(<span class="string">"湘桥月"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"1234567"</span>);</span><br><span class="line">        Date birthday=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"2017-5-6"</span>);</span><br><span class="line">        user.setBirthday(birthday);</span><br><span class="line">        user.setAddress(<span class="string">"测试修改用户"</span>);</span><br><span class="line">        user.setGender(<span class="number">1</span>);</span><br><span class="line">        user.setPhone(<span class="string">"1458ee45567"</span>);</span><br><span class="line">        user.setUserRole(<span class="number">1</span>);</span><br><span class="line">        user.setModifyBy(<span class="number">1</span>);</span><br><span class="line">        user.setModifyDate(<span class="keyword">new</span> Date());</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).modify(user);</span><br><span class="line">        <span class="comment">//模拟异常,进行回滚</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.debug(<span class="string">"是否修改成功------&gt;"</span>+count);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="delete语句"><a class="header-anchor" href="#delete语句"></a>delete语句</h5>
<blockquote>
<p>示例:根据用户ID删除用户</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------UserMapper.java---------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">modify</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">--------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------UserMapper.xml-------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"modify"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    UPDATE smbms_user set userCode=#&#123;userCode&#125;,userName=#&#123;userName&#125;,userPassword=#&#123;userPassword&#125;,gender=#&#123;gender&#125;,</span><br><span class="line">    birthday=#&#123;birthday&#125;,phone=#&#123;phone&#125;,address=#&#123;address&#125;,userRole=#&#123;userRole&#125;,modifyBy=#&#123;modifyBy&#125;,</span><br><span class="line">    modifyDate=#&#123;modifyDate&#125; where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModify</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">16</span>);</span><br><span class="line">        user.setUserCode(<span class="string">"teaper"</span>);</span><br><span class="line">        user.setUserName(<span class="string">"湘桥月"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"1234567"</span>);</span><br><span class="line">        Date birthday=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"2017-5-6"</span>);</span><br><span class="line">        user.setBirthday(birthday);</span><br><span class="line">        user.setAddress(<span class="string">"测试修改用户"</span>);</span><br><span class="line">        user.setGender(<span class="number">1</span>);</span><br><span class="line">        user.setPhone(<span class="string">"1458ee45567"</span>);</span><br><span class="line">        user.setUserRole(<span class="number">1</span>);</span><br><span class="line">        user.setModifyBy(<span class="number">1</span>);</span><br><span class="line">        user.setModifyDate(<span class="keyword">new</span> Date());</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).modify(user);</span><br><span class="line">        <span class="comment">//模拟异常,进行回滚</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.debug(<span class="string">"是否修改成功------&gt;"</span>+count);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h5 id="delete语句-v2"><a class="header-anchor" href="#delete语句-v2"></a>delete语句</h5>
<p>示例:根据用户ID删除用户</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----------------------UserMapper.java-------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteUserById</span><span class="params">(@Param(<span class="string">"id"</span>)</span><span class="keyword">int</span> id)<span class="keyword">throws</span> Exception</span>;</span><br><span class="line">--------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">----------------UserMapper.xml-------------</span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteUserById"</span>&gt;</span></span><br><span class="line">    delete from smbms_user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">-------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDeleteUserById</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).deleteUserById(<span class="number">16</span>);</span><br><span class="line">        <span class="comment">//模拟异常,进行回滚</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.debug(<span class="string">"是否删除成功------&gt;"</span>+count);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="select高级结果映射"><a class="header-anchor" href="#select高级结果映射"></a>select高级结果映射</h4>
<p><span style="color:#B900ff;">association</span>:<span style="color:#ff0000;">一对一</span></p>
<ul>
<li>复杂数据类型关联:比如User(从)类中嵌套Role(主)对象</li>
<li>内部嵌套
<ul>
<li>映射一个嵌套JavaBean属性</li>
</ul>
</li>
<li>属性
<ul>
<li><span style="color:#ff9900;">property</span>:映射数据库列的实体对象的属性</li>
<li><span style="color:#ff9900;">javaType</span>:完整Java类名或者别名</li>
<li><span style="color:#ff9900;">resultMap</span>:引用外部resultMap</li>
</ul>
</li>
<li>子元素
<ul>
<li><span style="color:#ff9900;">id</span></li>
<li><span style="color:#ff9900;">result</span>
<ul>
<li><span style="color:#ff9900;">property</span>:映射数据库列的实体对象的属性</li>
<li><span style="color:#ff9900;">column</span>:数据库列名或者别名</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例:根据用户ID查询用户信息(association)</p>
</blockquote>
<p>注释掉userRoleName属性以及它的get,set方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">--------------------User.java--------------------------</span><br><span class="line"><span class="comment">//private String userRoleName;    //用户角色名称</span></span><br><span class="line"><span class="comment">//  public String getUserRoleName() &#123;</span></span><br><span class="line"><span class="comment">//      return userRoleName;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"><span class="comment">//  public void setUserRoleName(String userRoleName) &#123;</span></span><br><span class="line"><span class="comment">//      this.userRoleName = userRoleName;</span></span><br><span class="line"><span class="comment">//  &#125;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> Role role; <span class="comment">//添加角色role</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> Role <span class="title">getRole</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> role;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------UserMapper.java---------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByRoleId</span><span class="params">(@Param(<span class="string">"userRole"</span>)</span> Integer roleId) <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------------------------UserMapper.xml-------------------------------------------------------------</span><br><span class="line"><span class="comment">&lt;!-- 新增resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userRoleResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRole"</span> <span class="attr">property</span>=<span class="string">"userRole"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 新增association节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"Role"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"a_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleCode"</span> <span class="attr">property</span>=<span class="string">"roleCode"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleName"</span> <span class="attr">property</span>=<span class="string">"roleName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByRoleId"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    select u.* ,r.id,r.roleCode,r.roleName from smbms_user u ,smbms_role r where u.userRole=#&#123;userRole&#125; and u.userRole = r.id  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">                                ----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByRoleId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    Integer roleId=<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByRoleId(roleId);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getUserName()+<span class="string">"\t"</span>+_user.getRole().getId()+<span class="string">"\t"</span></span><br><span class="line">    +_user.getRole().getRoleCode()+<span class="string">"\t"</span>+_user.getRole().getRoleName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>如果我们希望association的role结果映射可以复用,那么我们可以使用association提供的另一个属性resultMap进行扩展</p>
<p>把association中内容抽调出来做个resultMap,通过association的resultMap属性引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------------------------UserMapper.xml-------------------------------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userRoleResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRole"</span> <span class="attr">property</span>=<span class="string">"userRole"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- association引用外部resultMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"role"</span> <span class="attr">javaType</span>=<span class="string">"Role"</span> <span class="attr">resultMap</span>=<span class="string">"roleResult"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 把association中内容抽调出来做个resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Role"</span> <span class="attr">id</span>=<span class="string">"roleResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"a_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleCode"</span> <span class="attr">property</span>=<span class="string">"roleCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleName"</span> <span class="attr">property</span>=<span class="string">"roleName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">&lt;!-- select语句不变 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByRoleId"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    select u.* ,r.id,r.roleCode,r.roleName from smbms_user u ,smbms_role r where u.userRole=#&#123;userRole&#125; and u.userRole = r.id  </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#B900ff;">collection</span>:<span style="color:#ff0000;">一对多</span></p>
<ul>
<li>复杂类型集合:比如User(主)类中嵌套Address(从)集合类</li>
<li>内部嵌套
<ul>
<li>映射一个嵌套结果集到一个列表</li>
</ul>
</li>
<li>属性
<ul>
<li><span style="color:#ff9900;">property</span>:映射数据库列的实体对象的属性</li>
<li><span style="color:#ff9900;">fType</span>:完整Java类名或者别名(集合所包括的类型)</li>
<li><span style="color:#ff9900;">resultMap</span>:引用外部resultMap</li>
</ul>
</li>
<li>子元素</li>
<li><span style="color:#ff9900;">id</span></li>
<li><span style="color:#ff9900;">result</span>
<ul>
<li><span style="color:#ff9900;">property</span>:映射数据库列的实体对象的属性</li>
<li><span style="color:#ff9900;">column</span>:数据库列名或者别名</li>
</ul>
</li>
</ul>
<blockquote>
<p>示例:获取指定用户的相关信息和地址列表(collection)</p>
</blockquote>
<p>pojo实体类添加Address.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---------------------------Address.java--------------------------</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;             <span class="comment">//id</span></span><br><span class="line">    <span class="keyword">private</span> String postCode;        <span class="comment">//邮编</span></span><br><span class="line">    <span class="keyword">private</span> String contact;         <span class="comment">//联系人</span></span><br><span class="line">    <span class="keyword">private</span> String addressDesc;     <span class="comment">//地址</span></span><br><span class="line">    <span class="keyword">private</span> String tel;             <span class="comment">//联系电话</span></span><br><span class="line">    <span class="keyword">private</span> Integer createdBy;      <span class="comment">//创建者</span></span><br><span class="line">    <span class="keyword">private</span> Date creationDate;      <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> Integer modifyBy;       <span class="comment">//更新者</span></span><br><span class="line">    <span class="keyword">private</span> Date modifyDate;        <span class="comment">//更新时间</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;         <span class="comment">//用户Id</span></span><br><span class="line">    <span class="comment">//省略getter和setter方法</span></span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">----------------------------User.java----------------------------</span><br><span class="line"><span class="keyword">private</span> List&lt;Address&gt; addressList;<span class="comment">//用户地址列表</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Address&gt; <span class="title">getAddressList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> addressList;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddressList</span><span class="params">(List&lt;Address&gt; addressList)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.addressList = addressList;</span><br><span class="line">&#125;</span><br><span class="line">-----------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.java-----------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getAddressListByUserId</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer userId)</span>;</span><br><span class="line">------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------MyBatis-config.xml--------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 新增Address类映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Address"</span> <span class="attr">type</span>=<span class="string">"cn.smbms.pojo.Address"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------UserMapper.xml---------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userAddressResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 新增collection节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"addressList"</span> <span class="attr">ofType</span>=<span class="string">"Address"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"a_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"postCode"</span> <span class="attr">property</span>=<span class="string">"postCode"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tel"</span> <span class="attr">property</span>=<span class="string">"tel"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"contact"</span> <span class="attr">property</span>=<span class="string">"contact"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"addressDesc"</span> <span class="attr">property</span>=<span class="string">"addressDesc"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAddressListByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"userAddressResult"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    select u.*,a.id as a_id ,a.contact,a.addressDesc,a.postCode,a.tel</span><br><span class="line">    from smbms_user u,smbms_address a where u.id =a.userId and  u.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetAddressListByUserId</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    Integer userId=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getAddressListByUserId(userId);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getUserName()+<span class="string">"\t"</span>+_user.getUserCode());</span><br><span class="line">        <span class="keyword">for</span>(Address address:_user.getAddressList())&#123;</span><br><span class="line">            logger.debug(address.getId()+<span class="string">"\t"</span>+address.getContact()+<span class="string">"\t"</span>+address.getAddressDesc()</span><br><span class="line">            +<span class="string">"\t"</span>+address.getTel()+<span class="string">"\t"</span>+address.getPostCode());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>同理,如果我们希望collection的Address结果映射可以复用,那么我们可以使用collection提供的resultMap属性进行扩展</p>
<p>把collection中内容抽调出来做个resultMap,通过collection的resultMap属性引用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------UserMapper.xml---------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userAddressResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 新增collection节点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"addressList"</span> <span class="attr">ofType</span>=<span class="string">"Address"</span> <span class="attr">resultMap</span>=<span class="string">"addressResult"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 把collection中内容抽调出来做个resultMap --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Address"</span> <span class="attr">id</span>=<span class="string">"addressResult"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"a_id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"postCode"</span> <span class="attr">property</span>=<span class="string">"postCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"tel"</span> <span class="attr">property</span>=<span class="string">"tel"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"contact"</span> <span class="attr">property</span>=<span class="string">"contact"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"addressDesc"</span> <span class="attr">property</span>=<span class="string">"addressDesc"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- SQL语句不变 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAddressListByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"userAddressResult"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span></span><br><span class="line">    select u.*,a.id as a_id ,a.contact,a.addressDesc,a.postCode,a.tel</span><br><span class="line">    from smbms_user u,smbms_address a where u.id =a.userId and  u.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="MyBatis缓存"><a class="header-anchor" href="#MyBatis缓存"></a>MyBatis缓存</h4>
<p>一级缓存:基于PerpetualCache(MyBatis自带)的HashMap本地缓存<br>
作用范围:session域内(当session被flush/close后,缓存清空)</p>
<p>二级缓存:global caching;超出session范围,可以被SqlSession共享</p>
<p><span style="color:#ff0000;">注意:一级缓存缓存的是SQL语句,二级缓存缓存的是结果对象</span></p>
<h5 id="二级缓存配置"><a class="header-anchor" href="#二级缓存配置"></a>二级缓存配置</h5>
<p><span style="color:#ff0000;">方法一:在mybatis-config.xml中配置全局cache</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-------------------------mybatis-config.xml--------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法二:在Mapper.xml中配置(默认:未开启)</span></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------mybatis-config.xml-------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.smbms.dao.user.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">"FIFIO"</span> <span class="attr">flushInterval</span>=<span class="string">"60000"</span> <span class="attr">size</span>=<span class="string">"512"</span> <span class="attr">readOnly</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>在Mapper文件支持cache后,如果需要对个别查询进行调整,可以单独设置cache</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------UserMapper.xml----------------------------------------------</span><br><span class="line"><span class="comment">&lt;!-- select节点中设置userCache属性为true即可 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAddressListByUserId"</span> <span class="attr">resultMap</span>=<span class="string">"userAddressResult"</span> <span class="attr">parameterType</span>=<span class="string">"Integer"</span> <span class="attr">userCache</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    select u.*,a.id as a_id ,a.contact,a.addressDesc,a.postCode,a.tel</span><br><span class="line">    from smbms_user u,smbms_address a where u.id =a.userId and  u.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-----------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="动态SQL"><a class="header-anchor" href="#动态SQL"></a>动态SQL</h4>
<p>基于OGNL表达式<br>
使用动态SQL完成多条件查询等逻辑实现<br>
动态SQL元素:</p>
<ul>
<li><span style="color:#ff9900;">if</span>:利用if实现简单的条件选择</li>
<li><span style="color:#ff9900;">choose</span>:相当于Java中的switch语句,通常与where和otherwise搭配
<ul>
<li><span style="color:#ff9900;">where</span></li>
<li><span style="color:#ff9900;">otherwise</span></li>
</ul>
</li>
<li><span style="color:#ff9900;">where</span>:简化SQL语句中的where条件判断</li>
<li><span style="color:#ff9900;">set</span>:解决动态更新语句</li>
<li><span style="color:#ff9900;">trim</span>:可以灵活的去除多余关键字</li>
<li><span style="color:#ff9900;">foreach</span>:迭代一个集合,通常用于in条件</li>
</ul>
<h4 id="多条件查询-v2"><a class="header-anchor" href="#多条件查询-v2"></a>多条件查询</h4>
<p><span style="color:#ff0000;">方法一:if+where多条件查询</span></p>
<p>示例:改造查询用户列表示例,增加查询条件(用户角色id,用户名称&quot;模糊查询&quot;)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">----------------------User.java------------------------</span><br><span class="line"><span class="keyword">private</span> Integer userRole;       <span class="comment">//用户角色</span></span><br><span class="line"><span class="keyword">private</span> String userRoleName;    <span class="comment">//用户角色名称</span></span><br><span class="line"><span class="comment">//省略其getter/setter方法</span></span><br><span class="line">-------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------UserMapper.java-------------------------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">(@Param(<span class="string">"userName"</span>)</span> String userName,@<span class="title">Param</span><span class="params">(<span class="string">"userRole"</span>)</span> Integer RoleId) <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r</span><br><span class="line">     where u.userRole=r.id</span><br><span class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span></span><br><span class="line">        and u.userRole=#&#123;userRole&#125;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>&gt;</span></span><br><span class="line">        and u.userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">     <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">//不论userName/RoleId设置为null还是"",都可以查询出相应结果</span></span><br><span class="line">    String userName=<span class="string">"明"</span>;</span><br><span class="line">    Integer RoleId=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserList(userName,RoleId);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getAddress()+<span class="string">"\t"</span>+_user.getUserName()+<span class="string">"\t"</span></span><br><span class="line">        +_user.getUserRoleName()+<span class="string">"\t"</span>+_user.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p>从 <code>UserMapper.xml</code> 中可以发现,我们的where条件中是设置了<code>&quot;where u.userRole=r.id&quot;</code>,所以语句拼接没有问题,如果想让他自动控制where条件的and和or,我们可以使用where节点,改造上面的SQL</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r</span><br><span class="line">     <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>&gt;</span></span><br><span class="line">            and u.userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span></span><br><span class="line">            and u.userRole=#&#123;userRole&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法二:if+trim多条件查询</span></p>
<p>trim属性:</p>
<ul>
<li><span style="color:#ff9900;">prefix</span>:前缀,作用是通过自动识别是否有返回值</li>
<li><span style="color:#ff9900;">suffix</span>:后缀,作用是在trim包含的内容上加上后缀</li>
<li><span style="color:#ff9900;">prefixOverrides</span>:对于trim内容的首部进行指定内容(例如:and | or)的忽略</li>
<li><span style="color:#ff9900;">suffixOverrides</span>:对于trim包含内容的首尾部进行指定内容的忽略</li>
</ul>
<p>更灵活的去除多余关键字(where,and,or)</p>
<p>替代where</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r</span><br><span class="line">     <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"where"</span> <span class="attr">prefixOverrides</span>=<span class="string">"and | or"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>&gt;</span></span><br><span class="line">            and u.userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span></span><br><span class="line">            and u.userRole=#&#123;userRole&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法三:choose(when,otherwise)多条件查询</span><br>
示例:根据条件(用户名称,用户角色,用户编码,创建时间)查询用户表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------UserMapper.java-------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList_choose</span><span class="params">(@Param(<span class="string">"userName"</span>)</span>String userName,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"userRole"</span>)</span>Integer roleId,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"userCode"</span>)</span>String userCode,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"creationDate"</span>)</span>Date creationDate)<span class="keyword">throws</span> Exception</span>;</span><br><span class="line">-----------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-----------------------UserMapper.xml--------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList_choose"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span> &gt;</span></span><br><span class="line">            and userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"userCode !=null and userCode !=''"</span>&gt;</span></span><br><span class="line">            and userCode like concat ('%',#&#123;userCode&#125;,'%')</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span></span><br><span class="line">            and userRole=#&#123;userRole&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and YEAR(creationDate) = YEAR(#&#123;creationDate&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">---------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-------------------------------------------TeatUserMapper.java--------------------------------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserList_choose</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    String userName=<span class="string">"明"</span>;</span><br><span class="line">    Integer roleId=<span class="keyword">null</span>;</span><br><span class="line">    String userCode=<span class="string">""</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        Date creationDate =<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"2014-12-31"</span>);</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserList_choose(userName, roleId, userCode, creationDate);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRole()+<span class="string">"\t"</span>+_user.getCreationDate());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="动态SQL更新"><a class="header-anchor" href="#动态SQL更新"></a>动态SQL更新</h4>
<p>在之前的例子中,我们是直接set所有字段,若某个参数为null会导致更新错误,若要自动根据参数更新</p>
<p><span style="color:#ff0000;">方法一:if+set更新</span><br>
示例:根据用户ID修改用户信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------UserMapper.java---------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">modify</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">--------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml---------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"modify"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    UPDATE smbms_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCode != null"</span>&gt;</span>userCode=#&#123;userCode&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null"</span>&gt;</span>userName=#&#123;userName&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userPassword != null"</span>&gt;</span>userPassword=#&#123;userPassword&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender != null"</span>&gt;</span>gender=#&#123;gender&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthday != null"</span>&gt;</span>birthday=#&#123;birthday&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null"</span>&gt;</span>address=#&#123;address&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span>userRole=#&#123;userRole&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"modifyBy != null"</span>&gt;</span>modifyBy=#&#123;modifyBy&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最后一行记得也要加上逗号,set会自动剔除多余逗号,不用担心会多余 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"modifyDate != null"</span>&gt;</span>modifyDate=#&#123;modifyDate&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">     where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testModify</span><span class="params">()</span></span>&#123;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">int</span> count =<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">16</span>);</span><br><span class="line">        user.setUserCode(<span class="string">"teaper"</span>);</span><br><span class="line">        user.setUserName(<span class="string">"湘桥月"</span>);</span><br><span class="line">        user.setUserPassword(<span class="string">"1234567"</span>);</span><br><span class="line">        Date birthday=<span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>).parse(<span class="string">"2017-5-6"</span>);</span><br><span class="line">        user.setBirthday(birthday);</span><br><span class="line">        user.setAddress(<span class="keyword">null</span>);<span class="comment">//设置为null测试</span></span><br><span class="line">        user.setGender(<span class="number">1</span>);</span><br><span class="line">        user.setPhone(<span class="string">""</span>);<span class="comment">//设置为""测试</span></span><br><span class="line">        user.setUserRole(<span class="number">1</span>);</span><br><span class="line">        user.setModifyBy(<span class="number">1</span>);</span><br><span class="line">        user.setModifyDate(<span class="keyword">new</span> Date());</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).modify(user);</span><br><span class="line">        <span class="comment">//模拟异常,进行回滚</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        sqlSession.rollback();</span><br><span class="line">        count=<span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.debug(<span class="string">"是否修改成功------&gt;"</span>+count);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法二:if+trim更新</span><br>
我们也可以使用trim元素替换set元素,更精准的剔除逗号,拼接前后缀</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml---------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"modify"</span> <span class="attr">parameterType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">    UPDATE smbms_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"set"</span> <span class="attr">suffixOverrides</span>=<span class="string">","</span> <span class="attr">suffix</span>=<span class="string">"where id=#&#123;id&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userCode != null"</span>&gt;</span>userCode=#&#123;userCode&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName != null"</span>&gt;</span>userName=#&#123;userName&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userPassword != null"</span>&gt;</span>userPassword=#&#123;userPassword&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"gender != null"</span>&gt;</span>gender=#&#123;gender&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"birthday != null"</span>&gt;</span>birthday=#&#123;birthday&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"phone != null"</span>&gt;</span>phone=#&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"address != null"</span>&gt;</span>address=#&#123;address&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span>userRole=#&#123;userRole&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"modifyBy != null"</span>&gt;</span>modifyBy=#&#123;modifyBy&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"modifyDate != null"</span>&gt;</span>modifyDate=#&#123;modifyDate&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span>&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="MyBatis的foreach迭代"><a class="header-anchor" href="#MyBatis的foreach迭代"></a>MyBatis的foreach迭代</h4>
<p><span style="color:#ff9900;">foreach</span>:迭代一个集合,通常用于in条件</p>
<p>属性:</p>
<ul>
<li><span style="color:#ff9900;">item</span>:表示集合中每个元素进行迭代时的别名</li>
<li><span style="color:#ff9900;">index</span>:指定一个名称,用于迭代过程中每次迭代到的位置</li>
<li><span style="color:#ff9900;">collection</span>:必须指定,不同情况下的属性值不一样</li>
<li><span style="color:#ff9900;">open</span>:表示该语句以什么开始(既然是in条件,必然以&quot;(&quot;开始)</li>
<li><span style="color:#ff9900;">separator</span>:表示每次进行迭代之间以什么符号作为分隔符(既然是in条件,必然以&quot;,&quot;分隔)</li>
<li><span style="color:#ff9900;">close</span>:表示该语句以什么结束(既然是in条件,必然以&quot;)&quot;结束)</li>
</ul>
<p>示例:根据用户角色列表,获取该角色下用户列表信息<br>
<span style="color:#ff0000;">方法一:入参为数组类型的foreach迭代</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------UserMapper.java----------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByRoleId_foreach_array</span><span class="params">(Integer[] roleIds)</span><span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml---------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByRoleId_foreach_array"</span> <span class="attr">resultMap</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where userRole in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">item</span>=<span class="string">"roleIds"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;roleIds&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------------TeatUserMapper.java------------------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByRoleId_foreach_array</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    Integer[] roleIds=&#123;<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByRoleId_foreach_array(roleIds);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getId()+<span class="string">"\t"</span>+_user.getUserCode()+<span class="string">"\t"</span></span><br><span class="line">                +_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRole());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">注意:UserMapper.xml中的select:getUserListByRoleId_foreach_array中没有指定parameterType,因为配置文件中的parameterType是可以不用配置的,MyBatis会自动把他封装成一个Map进行传入;但是,当入参为Collection时,不能直接传入Collection对象,需要将其转换为List或数组</span></p>
<p><span style="color:#ff0000;">方法二:入参为List类型的foreach迭代</span></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------UserMapper.java------------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByRoleId_foreach_list</span><span class="params">(List&lt;Integer&gt; roleList)</span><span class="keyword">throws</span> Exception</span>;</span><br><span class="line">-------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">----------------------------UserMapper.xml---------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByRoleId_foreach_list"</span> <span class="attr">resultMap</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where userRole in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">item</span>=<span class="string">"roleList"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;roleList&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">----------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByRoleId_foreach_list</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    List&lt;Integer&gt; roleList=<span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    roleList.add(<span class="number">2</span>);</span><br><span class="line">    roleList.add(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByRoleId_foreach_list(roleList);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getId()+<span class="string">"\t"</span>+_user.getUserCode()+<span class="string">"\t"</span></span><br><span class="line">                +_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRole());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<p><span style="color:#ff0000;">方法三:入参为Map类型的foreach迭代</span></p>
<p>示例:根据传入的用户角色列表和性别获取相应的用户信息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------UserMapper.java---------------------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserListByRoleId_foreach_map</span><span class="params">(Map&lt;String,Object&gt; conditionMap)</span><span class="keyword">throws</span> Exception</span>;</span><br><span class="line">---------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">--------------------------------UserMapper.xml------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserListByRoleId_foreach_map"</span> <span class="attr">resultMap</span>=<span class="string">"userMapByRole"</span>&gt;</span></span><br><span class="line">    select * from smbms_user where gender=#&#123;gender&#125; and userRole in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"roleIds"</span> <span class="attr">item</span>=<span class="string">"roleMap"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;roleMap&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">-----------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">----------------------------------TeatUserMapper.java--------------------------------</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserListByRoleId_foreach_map</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    Map&lt;String,Object&gt; conditionMap=<span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">    List&lt;Integer&gt; roleList=<span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    roleList.add(<span class="number">2</span>);</span><br><span class="line">    roleList.add(<span class="number">3</span>);</span><br><span class="line">    conditionMap.put(<span class="string">"gender"</span>, <span class="number">1</span>);</span><br><span class="line">    conditionMap.put(<span class="string">"roleIds"</span>, roleList);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserListByRoleId_foreach_map(conditionMap);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getId()+<span class="string">"\t"</span>+_user.getUserCode()+<span class="string">"\t"</span></span><br><span class="line">                +_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRole());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="MyBatis分页"><a class="header-anchor" href="#MyBatis分页"></a>MyBatis分页</h4>
<p>示例:分页查询用户列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---------------------------UserMapper.java-------------------------</span><br><span class="line"><span class="comment">//查询总记录数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询用户列表(分页)</span></span><br><span class="line"><span class="comment"> * getCount() 之前已写过,获取总记录数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userName 用户名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> roleId 角色编号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> currentPageNo  起始位置</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> pageSize 页面大小</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">getUserList</span><span class="params">(@Param(<span class="string">"userName"</span>)</span> String userName,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"userRole"</span>)</span> Integer roleId,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"from"</span>)</span> Integer currentPageNo,</span></span><br><span class="line"><span class="function">        @<span class="title">Param</span><span class="params">(<span class="string">"pageSize"</span>)</span> Integer pageSize) <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">-------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">---------------------------------------UserMapper.xml-----------------------------------------</span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"User"</span> <span class="attr">id</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userName"</span> <span class="attr">property</span>=<span class="string">"userName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"roleName"</span> <span class="attr">property</span>=<span class="string">"roleName"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userCode"</span> <span class="attr">property</span>=<span class="string">"userCode"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userPassword"</span> <span class="attr">property</span>=<span class="string">"userPassword"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"gender"</span> <span class="attr">property</span>=<span class="string">"gender"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"birthday"</span> <span class="attr">property</span>=<span class="string">"birthday"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"phone"</span> <span class="attr">property</span>=<span class="string">"phone"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRole"</span> <span class="attr">property</span>=<span class="string">"userRole"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createdBy"</span> <span class="attr">property</span>=<span class="string">"createdBy"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"creationDate"</span> <span class="attr">property</span>=<span class="string">"creationDate"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"modifyBy"</span> <span class="attr">property</span>=<span class="string">"modifyBy"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"modifyDate"</span> <span class="attr">property</span>=<span class="string">"modifyDate"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"idPicPath"</span> <span class="attr">property</span>=<span class="string">"idPicPath"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"workPicPath"</span> <span class="attr">property</span>=<span class="string">"workPicPath"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"userRoleName"</span> <span class="attr">property</span>=<span class="string">"userRoleName"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 获取总记录数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCount"</span> <span class="attr">resultType</span>=<span class="string">"int"</span>&gt;</span></span><br><span class="line">    select count(1) from smbms_user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 分页查询用户列表(降序) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getUserList"</span> <span class="attr">resultMap</span>=<span class="string">"userList"</span>&gt;</span></span><br><span class="line">    select u.*,r.roleName as userRoleName from smbms_user u,smbms_role r where u.userRole=r.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userName !=null and userName !=''"</span>&gt;</span></span><br><span class="line">        and u.userName like concat ('%',#&#123;userName&#125;,'%')</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"userRole != null"</span>&gt;</span></span><br><span class="line">        and u.userRole=#&#123;userRole&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    order by creationDate DESC limit #&#123;from&#125;,#&#123;pageSize&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------TeatUserMapper.java--------------------------------------------</span><br><span class="line"><span class="comment">//获取总记录数</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetCount</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        count = sqlSession.getMapper(UserMapper.class).getCount();</span><br><span class="line">        logger.debug(<span class="string">"COUNT等于:----&gt;"</span>+count);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//分页查询用户列表(降序)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUserList</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userlist= <span class="keyword">null</span>;</span><br><span class="line">    SqlSession sqlSession = <span class="keyword">null</span>;</span><br><span class="line">    String userName=<span class="keyword">null</span>;</span><br><span class="line">    Integer roleId=<span class="keyword">null</span>;</span><br><span class="line">    Integer pageSize=<span class="number">5</span>;</span><br><span class="line">    Integer currentPageNo=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        sqlSession = MyBatisUtil.creataSqlSession();</span><br><span class="line">        userlist = sqlSession.getMapper(UserMapper.class).getUserList(userName, roleId, currentPageNo, pageSize);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">        MyBatisUtil.closeSqlSession(sqlSession);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(User _user:userlist)&#123;</span><br><span class="line">        logger.debug(_user.getId()+<span class="string">"\t"</span>+_user.getUserCode()+<span class="string">"\t"</span>+_user.getUserName()+<span class="string">"\t"</span>+_user.getUserRoleName()</span><br><span class="line">        +<span class="string">"\t"</span>+_user.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">------------------------------------------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure>
<h4 id="Log日志"><a class="header-anchor" href="#Log日志"></a>Log日志</h4>
<p><code>pom.xml</code>中加入jar包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- log4j/sfl4j日志处理 </span></span><br><span class="line"><span class="comment">slf4j-api-1.7.21.jar</span></span><br><span class="line"><span class="comment">slf4j-log4j12-1.7.21.jar</span></span><br><span class="line"><span class="comment">log4j-1.2.17.jar</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在项目的 <code>resources</code> 文件夹创建 <code>login.properties</code> 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">log4j.rootLogger=info,debug,CONSOLE,file</span><br><span class="line">#log4j.rootLogger=ERROR,ROLLING_FILE</span><br><span class="line"></span><br><span class="line">log4j.logger.cn.appsys=info</span><br><span class="line">log4j.logger.org.apache.ibatis=info</span><br><span class="line">log4j.logger.org.mybatis.spring=info</span><br><span class="line">log4j.logger.java.sql.Connection=info</span><br><span class="line">log4j.logger.java.sql.Statement=info</span><br><span class="line">log4j.logger.java.sql.PreparedStatement=info</span><br><span class="line">log4j.logger.java.sql.ResultSet=info</span><br><span class="line"></span><br><span class="line">######################################################################################</span><br><span class="line"># Console Appender  \u65e5\u5fd7\u5728\u63a7\u5236\u8f93\u51fa\u914d\u7f6e</span><br><span class="line">######################################################################################</span><br><span class="line">log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</span><br><span class="line">log4j.appender.Threshold=info</span><br><span class="line">log4j.appender.CONSOLE.DatePattern=yyyy-MM-dd</span><br><span class="line">log4j.appender.CONSOLE.Target=System.out</span><br><span class="line">log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.CONSOLE.layout.ConversionPattern= - (%r ms) - %d&#123;yyyy-M-d HH:mm:ss&#125;%x[%5p](%F:%L) %m%n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">######################################################################################</span><br><span class="line"># Rolling File  \u6587\u4ef6\u5927\u5c0f\u5230\u8fbe\u6307\u5b9a\u5c3a\u5bf8\u7684\u65f6\u5019\u4ea7\u751f\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6</span><br><span class="line">######################################################################################</span><br><span class="line">#log4j.appender.ROLLING_FILE=org.apache.log4j.RollingFileAppender</span><br><span class="line">#log4j.appender.ROLLING_FILE.Threshold=INFO</span><br><span class="line">#log4j.appender.ROLLING_FILE.File=$&#123;baojia.root&#125;/logs/log.log</span><br><span class="line">#log4j.appender.ROLLING_FILE.Append=true</span><br><span class="line">#log4j.appender.ROLLING_FILE.MaxFileSize=5000KB</span><br><span class="line">#log4j.appender.ROLLING_FILE.MaxBackupIndex=100</span><br><span class="line">#log4j.appender.ROLLING_FILE.layout=org.apache.log4j.PatternLayout</span><br><span class="line">#log4j.appender.ROLLING_FILE.layout.ConversionPattern=%d&#123;yyyy-M-d HH:mm:ss&#125;%x[%5p](%F:%L) %m%n</span><br><span class="line"></span><br><span class="line">######################################################################################</span><br><span class="line"># DailyRolling File  \u6bcf\u5929\u4ea7\u751f\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\uff0c\u6587\u4ef6\u540d\u683c\u5f0f:log2009-09-11</span><br><span class="line">######################################################################################</span><br><span class="line">log4j.appender.file=org.apache.log4j.DailyRollingFileAppender</span><br><span class="line">log4j.appender.file.DatePattern=yyyy-MM-dd</span><br><span class="line">#注意，ProjectName改成你的工程名字，日志文件会生成到Linux系统的 ~/ 目录</span><br><span class="line">log4j.appender.file.File=$&#123;ProjectName.root&#125;/logs/log.log </span><br><span class="line">log4j.appender.file.Append=true</span><br><span class="line">log4j.appender.file.Threshold=info</span><br><span class="line">log4j.appender.file.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.file.layout.ConversionPattern= - (%r ms) - %d&#123;yyyy-M-d HH:mm:ss&#125;%x[%5p](%F:%L) %m%n</span><br><span class="line"></span><br><span class="line">#DWR \u65e5\u5fd7</span><br><span class="line">#log4j.logger.org.directwebremoting = ERROR</span><br><span class="line"></span><br><span class="line">#\u663e\u793aHibernate\u5360\u4f4d\u7b26\u7ed1\u5b9a\u503c\u53ca\u8fd4\u56de\u503c</span><br><span class="line">#log4j.logger.org.hibernate.type=DEBUG,CONSOLE </span><br><span class="line"></span><br><span class="line">#log4j.logger.org.springframework.transaction=DEBUG</span><br><span class="line">#log4j.logger.org.hibernate=DEBUG</span><br><span class="line">#log4j.logger.org.acegisecurity=DEBUG</span><br><span class="line">#log4j.logger.org.apache.myfaces=TRACE</span><br><span class="line">#log4j.logger.org.quartz=DEBUG</span><br><span class="line"></span><br><span class="line">#log4j.logger.com.opensymphony=INFO  </span><br><span class="line">#log4j.logger.org.apache.struts2=DEBUG  </span><br><span class="line">#log4j.logger.com.opensymphony.xwork2=debug</span><br></pre></td></tr></table></figure>
<p>在<code>web.xml</code>中配置加载器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置log4j文件  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:log4j.properties<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span></span><br><span class="line">		org.springframework.web.util.Log4jConfigListener</span><br><span class="line">	<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在需要使用的类中创建Log4j对象进行日志输出</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmpController</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Logger logger = Logger.getLogger(EmpController.class);</span><br><span class="line">    logger.info(<span class="string">"员工名字============》"</span>+empName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </article>
</div>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
<div class="container" id="gitalk-container"></div>
<script>
    var gitalk = new Gitalk({
        clientID: '79a82d93fcd761032f45',
        clientSecret: 'b784392d66d81a991565a56598f2d369e71e21ad',
        repo: 'hexoblog',
        owner: 'teaper',
        admin: ['teaper'],
	id: md5(location.pathname),
        distractionFreeMode: true
    })
    gitalk.render('gitalk-container')
</script>




</div>

<div class="footer-wrapper container">
  <footer class="footer clearfix">
    <div class="clearfix">
    <a href="https://www.teaper.dev" class="footer-logo">
      <i class="fa fa-github"></i>
    </a>
    <ul class="footer-social-link">
      <li>© 2019 teaper</li>
      <li><a href="https://www.teaper.dev">Home</a></li>
      
      <li><a href="https://github.com/teaper" rel="external nofollow noopener noreferrer" target="_blank">Github</a></li>
      
      <li><a href="https://www.weibo.com/5806191772" rel="external nofollow noopener noreferrer" target="_blank">Weibo</a></li>
      
      <li><a href="https://twitter.com/TEAPERS" rel="external nofollow noopener noreferrer" target="_blank">Twitter</a></li>
      
    </ul>
    <div class="footer-theme-info" id="hitokoto">
       行是知之始 ❤ 知是行之成
    </div>
    </div>
    
    <div class="footer-pageview">
        <a href="https://info.flagcounter.com/MrmG" rel="external nofollow noopener noreferrer" target="_blank">
          <img src="https://s04.flagcounter.com/count2/MrmG/bg_FFFFFF/txt_6A737D/border_FFFFFF/columns_7/maxflags_14/viewers_3/labels_1/pageviews_1/flags_0/percent_0/">
        </a>
    </div>
    
  </footer>
</div>
<!-- QPlayer音乐播放器 -->
<div id="QPlayer">
<div id="pContent">
	<div id="player">
		<span class="cover"></span>
		<div class="ctrl">
			<div class="musicTag marquee">
				<strong>Title</strong>
				 <span> - </span>
				<span class="artist">Artist</span>
			</div>
			<div class="progress">
				<div class="timer left">0:00</div>
				<div class="contr">
					<div class="rewind icon"></div>
					<div class="playback icon"></div>
					<div class="fastforward icon"></div>
				</div>
				<div class="right">
					<div class="liebiao icon"></div>
				</div>
			</div>
		</div>
	</div>
	<div class="ssBtn">
	        <div class="adf"></div>
    </div>
</div>
<ol id="playlist"></ol>
</div>
<!-- <script src="js/jquery.min.js"></script> -->
<!-- <script src="js/jquery.marquee.min.js"></script> -->
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/jquery.marquee/1.4.0/jquery.marquee.min.js"></script>

<script src="/js/playlist.js"></script>
<script src="/js/player.js"></script>
<script>
function bgChange(){
	var lis= $('.lib');
	for(var i=0; i<lis.length; i+=2)
	lis[i].style.background = 'rgba(246, 246, 246, 0.5)';
	
	$(".avatar").hover(function(){
		$(".avatar").attr({
		"src" : "http://ww1.sinaimg.cn/large/006kWbIoly1g763f4h9w5j30np0np40j.jpg"
		});
	},function(){
		$(".avatar").attr({
		"src" : "https://i.loli.net/2019/06/04/5cf683cea837456459.jpeg"
		});
	});
}
window.onload = bgChange;
</script>

<!-- Live2D血小板 -->
<div id="landlord">
    <div class="message" style="opacity:0"></div>
    <canvas id="live2d" width="560" height="500" class="live2d"></canvas>
    <!-- 省略隐藏按钮 -->
</div>

<!-- 鼠标单击爆炸区域 -->
<canvas class="fireworks" style="position:fixed;left:0;top:0;z-index:1031;pointer-events:none;"></canvas>

<script type="text/javascript" src="https://cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
    var message_Path = '/live2d/'
    var home_Path = 'https://www.teaper.dev/'
</script>
<script type="text/javascript" src="/live2d/js/live2d.js"></script>
<script type="text/javascript" src="/live2d/js/message.js"></script>
<script type="text/javascript">
    loadlive2d("live2d", "/live2d/model/xiaoban/model.json");
</script>

<!-- 打字泡沫 -->
<script type="text/javascript" src="/js/activate-power-mode.js"></script>
<script>
    POWERMODE.colorful = true;  
    POWERMODE.shake = false;    
    document.body.addEventListener('input', POWERMODE);
</script>

<!-- 引入一言 -->
<script src="https://cdn.jsdelivr.net/npm/bluebird@3/js/browser/bluebird.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/whatwg-fetch@2.0.3/fetch.min.js"></script>
<script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
<!-- <script src="/js/hitokoto.js"></script> -->

<!-- 粒子特效 -->
<!-- <script src="/js/canvas-nest.min.js"></script> -->

<!-- 鼠标单击爱心特效 -->
<script src="/js/mouse.js"></script>
<!-- 鼠标单击爆炸特效 -->
<script src="/js/anime.min.js"></script>
<script src="/js/fireworks.js"></script>

<!-- 站内搜索 -->
<script src="/js/search.js"></script>



<script>
  (function() {
    var cx = '014633199185561276043:bpv9wnr4qhc';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
      '//cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>



<script src="/js/main.js"></script>

</body>
</html>
